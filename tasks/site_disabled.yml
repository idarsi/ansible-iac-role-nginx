---
###############################################################################
#
# site_disabled.yml
#
# @author Arsi Atomi
#
###############################################################################

###############################################################################
# SETTING VARIABLES
###############################################################################

- name: "Setting variables"
  ansible.builtin.set_fact:
    nginx_autoconfigure: "{{ (nginx_site.autoconfigure | default(nginx_default_site_autoconfigure)) }}"

- name: "Checking if required variables are defined"
  ansible.builtin.assert:
    that:
      - nginx_site.name is defined
      - nginx_site.servers is defined or nginx_autoconfigure is defined
    fail_msg: "All tests did not pass"

###############################################################################
# CREATING CONFIGURATION IF AUTOCONFIGURATION IS TRUE
###############################################################################

- name: "Configuring with autoconfiguration if it is enabled"
  ansible.builtin.include_tasks: site_disabled_with_autoconfiguration.yml
  when: nginx_autoconfigure in ['website', 'proxy']

###############################################################################
# LOOPING THROUGH VIRTUAL HOSTS TO BE ADDED
###############################################################################

- name: "Looping through servers"
  ansible.builtin.include_tasks: "server_disabled.yml"
  loop: "{{ nginx_site.servers }}"
  loop_control:
    loop_var: nginx_server
  when: nginx_site.servers is defined

- name: "Writing log"
  ansible.builtin.include_tasks: log_write.yml
  vars:
    iac_log_write: "Ensured {{ nginx_site.name }} was disabled"
